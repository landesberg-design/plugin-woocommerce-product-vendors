jQuery(document).ready(function(c){"use strict";c.wc_product_vendors_admin={init:function(){c("#your-profile tr.show-admin-bar").remove(),wcpv_admin_local.isPendingVendor&&c("#dashboard-widgets").html('<p class="wcpv-pending-vendor-message">'+wcpv_admin_local.pending_vendor_message+"</p>"),c(".taxonomy-wcpv_product_vendors, .toplevel_page_wcpv-vendor-settings").on("click",".wcpv-upload-logo",function(e){e.preventDefault();var e=wcpv_admin_local,n=c(this).parents(".form-field").find('input[name="vendor_data[logo]"]'),t=c(this).parents(".form-field").find(".wcpv-logo-preview-image"),o=wp.media.frames.mediaFrame=wp.media({title:e.modalLogoTitle,button:{text:e.buttonLogoText},library:{type:"image"},multiple:!1});o.on("select",function(){o.state().get("selection").map(function(e){(e=e.toJSON()).id&&(n.val(e.id),t.prop("src",e.url).removeClass("hide"),c(n).parents(".form-field").find(".wcpv-remove-image").show())})}),o.open()}),c(".taxonomy-wcpv_product_vendors, .toplevel_page_wcpv-vendor-settings").on("click",".wcpv-remove-image",function(e){e.preventDefault(),c(this).hide(),c(this).parents(".form-field").find(".wcpv-logo-preview-image").prop("src","").addClass("hide"),c('input[name="vendor_data[logo]"]').val("")}),c(document.body).on("variable_vendor_commission",function(e){var n=window.prompt(woocommerce_admin_meta_boxes_variations.i18n_enter_a_value);null!=n&&c(':input[name^="_wcpv_product_variation_commission"]').val(n).trigger("change")}),c(".chart-widget .wcpv-vendor-search").length&&(n={formatMatches:function(e){return 1===e?wcpv_admin_local.i18n_matches_1:wcpv_admin_local.i18n_matches_n.replace("%qty%",e)},formatNoMatches:function(){return wcpv_admin_local.i18n_no_matches},formatAjaxError:function(){return wcpv_admin_local.i18n_ajax_error},formatInputTooShort:function(e,n){n-=e.length;return 1==n?wcpv_admin_local.i18n_input_too_short_1:wcpv_admin_local.i18n_input_too_short_n.replace("%qty%",n)},formatInputTooLong:function(e,n){e=e.length-n;return 1==e?wcpv_admin_local.i18n_input_too_long_1:wcpv_admin_local.i18n_input_too_long_n.replace("%qty%",e)},formatSelectionTooBig:function(e){return 1===e?wcpv_admin_local.i18n_selection_too_long_1:wcpv_admin_local.i18n_selection_too_long_n.replace("%qty%",e)},formatLoadMore:function(){return wcpv_admin_local.i18n_load_more},formatSearching:function(){return wcpv_admin_local.i18n_searching}},c(".wcpv-vendor-search-bar").filter(":not(.enhanced)").each(function(){var e={allowClear:!!c(this).data("allow_clear"),placeholder:c(this).data("placeholder"),minimumInputLength:c(this).data("minimum_input_length")?c(this).data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:wcpv_admin_local.ajaxurl,dataType:"json",quietMillis:250,data:function(e){return{term:e,action:"wcpv_vendor_search_ajax",security:wcpv_admin_local.vendor_search_nonce}},processResults:function(e){var t=[];return e&&c.each(e,function(e,n){t.push({id:e,text:n})}),{results:t}},cache:!0}};!0===c(this).data("multiple")?(e.multiple=!0,e.initSelection=function(t,e){var o=JSON.parse(t.attr("data-selected")),a=[];return c(t.val().split(",")).each(function(e,n){a.push({id:n,text:o[n]||t.data("placeholder")})}),e(a)},e.formatSelection=function(e){return'<div class="selected-option" data-id="'+e.id+'">'+e.text+"</div>"}):(e.multiple=!1,e.initSelection=function(e,n){return n({id:e.val(),text:e.attr("data-selected")||e.data("placeholder")})}),e=c.extend(e,n),c(this).select2(e).addClass("enhanced")}));var n,t,e=document.createElement("a");function o(e,n){var t=document.createElement("a");t.download=e,t.href=n,c(t).hide(),c(t).addClass("pv-temp-download"),c("body").append(t),t.click()}void 0===e.download&&(c(".wcpv-export-commissions-button").hide(),c(".wcpv-export-unpaid-commissions-button").hide(),c(e).remove()),c(document.body).on("click",".wcpv-export-commissions-button",function(e){e.preventDefault(),c(".pv-temp-download").remove();var e={action:"wcpv_export_commissions_ajax",nonce:c(this).data("nonce"),order_id:c(this).data("order_id"),year:c(this).data("year"),month:c(this).data("month"),vendor:c(this).data("vendor"),commission_status:c(this).data("commission_status")},n=c(this).prop("download");c.post(wcpv_admin_local.ajaxurl,e).done(function(e){o(n,"data:application/csv;charset=utf-8,"+encodeURIComponent(e))})}),c(document.body).on("click",".wcpv-export-unpaid-commissions-button",function(e){e.preventDefault(),c(".pv-temp-download").remove();var e={action:"wcpv_export_unpaid_commissions_ajax",nonce:c(this).data("nonce")},n=c(this).prop("download");c.post(wcpv_admin_local.ajaxurl,e).done(function(e){o(n,"data:application/csv;charset=utf-8,"+encodeURIComponent(e))})}),c("#wcpv_vendor_settings_paypal_masspay_environment").on("change",function(){var e=c("#wcpv_vendor_settings_paypal_masspay_client_id_live").parents("tr").eq(0),n=c("#wcpv_vendor_settings_paypal_masspay_client_secret_live").parents("tr").eq(0),t=c("#wcpv_vendor_settings_paypal_masspay_client_id_sandbox").parents("tr").eq(0),o=c("#wcpv_vendor_settings_paypal_masspay_client_secret_sandbox").parents("tr").eq(0);"sandbox"===c(this).val()?(e.hide(),n.hide(),t.show(),o.show()):(e.show(),n.show(),t.hide(),o.hide())}).trigger("change"),c(document.body).on("click",".wcpv-term-additional-settings-link",function(e){e.preventDefault(),c(".wcpv-term-additional-settings").slideToggle()}),c("#wcpv-product-vendor-terms-select").length&&c("#wcpv-product-vendor-terms-select").change(function(){var e=c(this).val(),n=c(this).children().filter('[value="'+e+'"]'),t=n.data("taxes"),n=n.data("pass-shipping"),o=c("#wcpv-product-vendor-tax-general-settings"),a=o.find('input[name="_wcpv_customize_product_vendor_settings"').prop("checked"),i=o.find(".wcpv-vendor-selection-notice");e?i.hide():i.show(),a||(t&&o.find(`input[name="_wcpv_product_taxes"][value="${t}"]`).prop("checked",!0),n&&o.find('input[name="_wcpv_product_pass_shipping"]').prop("checked","yes"===n))}).change(),c("#wcpv-product-vendor-tax-general-settings .wcpv_customize_settings_field").length&&c("#wcpv-product-vendor-tax-general-settings .wcpv_customize_settings_field input").change(function(){var e=c(this).prop("checked"),n=c("#wcpv-product-vendor-tax-general-settings > *:not(.wcpv_customize_settings_field):not(h2:nth-child(1)):not(.wcpv-vendor-selection-notice)");e?n.show():n.hide()}).change(),c("#wcpv_vendor_info").length&&null!=window.tinymce&&(t=tinymce.get("wcpv_vendor_info")).on("change",function(e){c("#wcpv_vendor_info").val(t.getContent())}),c(".js-import-csv-override").length&&c(".js-import-csv-override").on("click",function(e){return!!window.confirm(wcpv_admin_local.i18n_import_csv_override_confirmation_text)})}},c.wc_product_vendors_admin.init()});
