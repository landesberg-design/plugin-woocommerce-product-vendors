(()=>{"use strict";window.jQuery,jQuery(document).ready((function(e){e.wc_product_vendors_admin={init:function(){if(e("#your-profile tr.show-admin-bar").remove(),wcpv_admin_local.isPendingVendor&&e("#dashboard-widgets").html('<p class="wcpv-pending-vendor-message">'+wcpv_admin_local.pending_vendor_message+"</p>"),e(".taxonomy-wcpv_product_vendors, .toplevel_page_wcpv-vendor-settings").on("click",".wcpv-upload-logo",(function(n){n.preventDefault();var t=wcpv_admin_local,o=e(this).parents(".form-field").find('input[name="vendor_data[logo]"]'),a=e(this).parents(".form-field").find(".wcpv-logo-preview-image"),i=wp.media.frames.mediaFrame=wp.media({title:t.modalLogoTitle,button:{text:t.buttonLogoText},library:{type:"image"},multiple:!1});i.on("select",(function(){i.state().get("selection").map((function(n){(n=n.toJSON()).id&&(o.val(n.id),a.prop("src",n.url).removeClass("hide"),e(o).parents(".form-field").find(".wcpv-remove-image").show())}))})),i.open()})),e(".taxonomy-wcpv_product_vendors, .toplevel_page_wcpv-vendor-settings").on("click",".wcpv-remove-image",(function(n){n.preventDefault(),e(this).hide(),e(this).parents(".form-field").find(".wcpv-logo-preview-image").prop("src","").addClass("hide"),e('input[name="vendor_data[logo]"]').val("")})),e(document.body).on("variable_vendor_commission",(function(n){var t=window.prompt(woocommerce_admin_meta_boxes_variations.i18n_enter_a_value);null!=t&&e(':input[name^="_wcpv_product_variation_commission"]').val(t).trigger("change")})),e(".chart-widget .wcpv-vendor-search").length){var n={formatMatches:function(e){return 1===e?wcpv_admin_local.i18n_matches_1:wcpv_admin_local.i18n_matches_n.replace("%qty%",e)},formatNoMatches:function(){return wcpv_admin_local.i18n_no_matches},formatAjaxError:function(){return wcpv_admin_local.i18n_ajax_error},formatInputTooShort:function(e,n){var t=n-e.length;return 1===t?wcpv_admin_local.i18n_input_too_short_1:wcpv_admin_local.i18n_input_too_short_n.replace("%qty%",t)},formatInputTooLong:function(e,n){var t=e.length-n;return 1===t?wcpv_admin_local.i18n_input_too_long_1:wcpv_admin_local.i18n_input_too_long_n.replace("%qty%",t)},formatSelectionTooBig:function(e){return 1===e?wcpv_admin_local.i18n_selection_too_long_1:wcpv_admin_local.i18n_selection_too_long_n.replace("%qty%",e)},formatLoadMore:function(){return wcpv_admin_local.i18n_load_more},formatSearching:function(){return wcpv_admin_local.i18n_searching}};e(".wcpv-vendor-search-bar").filter(":not(.enhanced)").each((function(){var t={allowClear:!!e(this).data("allow_clear"),placeholder:e(this).data("placeholder"),minimumInputLength:e(this).data("minimum_input_length")?e(this).data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:wcpv_admin_local.ajaxurl,dataType:"json",quietMillis:250,data:function(e){return{term:e,action:"wcpv_vendor_search_ajax",security:wcpv_admin_local.vendor_search_nonce}},processResults:function(n){var t=[];return n&&e.each(n,(function(e,n){t.push({id:e,text:n})})),{results:t}},cache:!0}};!0===e(this).data("multiple")?(t.multiple=!0,t.initSelection=function(n,t){var o=JSON.parse(n.attr("data-selected")),a=[];return e(n.val().split(",")).each((function(e,t){a.push({id:t,text:o[t]||n.data("placeholder")})})),t(a)},t.formatSelection=function(e){return'<div class="selected-option" data-id="'+e.id+'">'+e.text+"</div>"}):(t.multiple=!1,t.initSelection=function(e,n){return n({id:e.val(),text:e.attr("data-selected")||e.data("placeholder")})}),t=e.extend(t,n),e(this).select2(t).addClass("enhanced")}))}var t=document.createElement("a");function o(n,t){var o=document.createElement("a");o.download=n,o.href=t,e(o).hide(),e(o).addClass("pv-temp-download"),e("body").append(o),o.click()}if(void 0===t.download&&(e(".wcpv-export-commissions-button").hide(),e(".wcpv-export-unpaid-commissions-button").hide(),e(t).remove()),e(document.body).on("click",".wcpv-export-commissions-button",(function(n){n.preventDefault(),e(".pv-temp-download").remove();var t={action:"wcpv_export_commissions_ajax",nonce:e(this).data("nonce"),order_id:e(this).data("order_id"),year:e(this).data("year"),month:e(this).data("month"),vendor:e(this).data("vendor"),commission_status:e(this).data("commission_status")},a=e(this).prop("download");e.post(wcpv_admin_local.ajaxurl,t).done((function(e){o(a,"data:application/csv;charset=utf-8,"+encodeURIComponent(e))}))})),e(document.body).on("click",".wcpv-export-unpaid-commissions-button",(function(n){n.preventDefault(),e(".pv-temp-download").remove();var t={action:"wcpv_export_unpaid_commissions_ajax",nonce:e(this).data("nonce")},a=e(this).prop("download");e.post(wcpv_admin_local.ajaxurl,t).done((function(e){o(a,"data:application/csv;charset=utf-8,"+encodeURIComponent(e))}))})),e("#wcpv_vendor_settings_paypal_masspay_environment").on("change",(function(){var n=e("#wcpv_vendor_settings_paypal_masspay_client_id_live").parents("tr").eq(0),t=e("#wcpv_vendor_settings_paypal_masspay_client_secret_live").parents("tr").eq(0),o=e("#wcpv_vendor_settings_paypal_masspay_client_id_sandbox").parents("tr").eq(0),a=e("#wcpv_vendor_settings_paypal_masspay_client_secret_sandbox").parents("tr").eq(0);"sandbox"===e(this).val()?(n.hide(),t.hide(),o.show(),a.show()):(n.show(),t.show(),o.hide(),a.hide())})).trigger("change"),e(document.body).on("click",".wcpv-term-additional-settings-link",(function(n){n.preventDefault(),e(".wcpv-term-additional-settings").slideToggle()})),e("#wcpv-product-vendor-terms-select").length&&e("#wcpv-product-vendor-terms-select").change((function(){var n=e(this).val(),t=e(this).children().filter('[value="'+n+'"]'),o=t.data("taxes"),a=t.data("pass-shipping"),i=e("#wcpv-product-vendor-tax-general-settings"),c=i.find('input[name="_wcpv_customize_product_vendor_settings"').prop("checked"),r=i.find(".wcpv-vendor-selection-notice");n?r.hide():r.show(),c||(o&&i.find(`input[name="_wcpv_product_taxes"][value="${o}"]`).prop("checked",!0),a&&i.find('input[name="_wcpv_product_pass_shipping"]').prop("checked","yes"===a))})).change(),e("#wcpv-product-vendor-tax-general-settings .wcpv_customize_settings_field").length&&e("#wcpv-product-vendor-tax-general-settings .wcpv_customize_settings_field input").change((function(){var n=e(this).prop("checked"),t=e("#wcpv-product-vendor-tax-general-settings > *:not(.wcpv_customize_settings_field):not(h2:nth-child(1)):not(.wcpv-vendor-selection-notice)");n?t.show():t.hide()})).change(),e("#wcpv_vendor_info").length&&null!=window.tinymce){var a=tinymce.get("wcpv_vendor_info");a.on("change",(function(n){e("#wcpv_vendor_info").val(a.getContent())}))}e(".js-import-csv-override").length&&e(".js-import-csv-override").on("click",(function(e){return!!window.confirm(wcpv_admin_local.i18n_import_csv_override_confirmation_text)}))}},e.wc_product_vendors_admin.init()}))})();